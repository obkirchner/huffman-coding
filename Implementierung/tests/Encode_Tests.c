#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "../src/huffman.h"

struct MinHNode* root;
double timee;

#define mu_assert(message, test) do { if (!(test)) return message; } while (0)
#define mu_run_test(test) do { char *message = test(); tests_run++; if (message) return message; } while (0)

int tests_run = 0;

static char* testSimpleString() {

    const char* data = "A SIMPLE STRING TO BE ENCODED USING A MINIMAL NUMBER OF BITS";

    char* str1 = "T1: Error: the Encoded string you got is: ";
    char* str2 = " But it should be  11011111100000110100110010011110011110000101110100010001011011101010100111011111001111100000011010010010010110010010111101111000001000101101111101111110100010000011010110111001111100010111101001111100110101110100011011111011100101011000";

    char* expected_result = "11011111100000110100110010011110011110000101110100010001011011101010100111011111001111100000011010010010010110010010111101111000001000101101111101111110100010000011010110111001111100010111101001111100110101110100011011111011100101011000";
    char* result = huffman_encode_tests(strlen(data),data);

    char* message = malloc(strlen(str1) + strlen(result) + strlen(str2) + 1);
    strcpy(message, str1);
    strcat(message, result);
    strcat(message, str2);

    //printf("%s\n",message);
    
    mu_assert(message, !strcmp(result, expected_result));

    free(message);
    free(result);
    return 0;

}


static char* testVeryLongString() {

    const char* data = "Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no ";

    char* str1 = "T2: Error: the Encoded string you got is: ";
    char* str2 = " But it should be ";      
    char* expected_result = "01100001011011100001011110011100110100001000101111001010111001010110111111100000111101111101001010001101011001111110010101111000100000011010001101010001111111000101000100011100110100011001000111100001101011100010010001111010111011001111100000000101110010001110100101111110001011110000100010101101111110000011011101011011001011111010000101100110101101111110011110001100111001100100100110001101111010011011111001010101100110101101110001110001101111001010111001010110111000111010110100110101100010101111010100100011100111010100011011110100101111000011110101101011001111100000000101110010001110100101111110011110111001001001001101101010010101001111111100111001101111110011100001111011111000101110001110001101111101011001011001001001000101001011110001101111011011010100100011011011111001001001011111001010111001010110111000100011100011011110001010111011100011001100100010110011111110110110011010001101111110010100100011110110101110110001101010000010111011010010011001100000111011010011100011000011001111110001011111100000010101111101101001100010011010110101101101011110001010110001100101101010010001110001000110111101100001011011100001011110011100110100001000101111001010111001010110111111100000111101111101001010001101100111111101100001011011100001011110011100110100001000101111001010111001010110111111100000111101111101001010001101011001111110010101111000100000011010001101010001111111000101000100011100110100011001000111100001101011100010010001111010111011001111100000000101110010001110100101111110001011110000100010101101111110000011011101011011001011111010000101100110101101111110011110001100111001100100100110001101111010011011111001010101100110101101110001110001101111001010111001010110111000111010110100110101100010101111010100100011100111010100011011110100101111000011110101101011001111100000000101110010001110100101111110011110111001001001001101101010010101001111111100111001101111110011100001111011111000101110001110001101111101011001011001001001000101001011110001101111011011010100100011011011111001001001011111001010111001010110111000100011100011011110001010111011100011001100100010110011111110110110011010001101111110010100100011110110101110110001101010000010111011010010011001100000111011010011100011000011001111110001011111100000010101111101101001100010011010110101101101011110001010110001100101101010010001110001000110111101100001011011100001011110011100110100001000101111001010111001010110111111100000111101111101001010001101100111111101100001011011100001011110011100110100001000101111001010111001010110111111100000111101111101001010001101011001111110010101111000100000011010001101010001111111000101000100011100110100011001000111100001101011100010010001111010111011001111100000000101110010001110100101111110001011110000100010101101111110000011011101011011001011111010000101100110101101111110011110001100111001100100100110001101111010011011111001010101100110101101110001110001101111001010111001010110111000111010110100110101100010101111010100100011100111010100011011110100101111000011110101101011001111100000000101110010001110100101111110011110111001001001001101101010010101001111111100111001101111110011100001111011111000101110001110001101111101011001011001001001000101001011110001101111011011010100100011011011111001001001011111001010111001010110111000100011100011011110001010111011100011001100100010110011111110110110011010001101111110010100100011110110101110110001101010000010111011010010011001100000111011010011100011000011001111110001011111";
char* result = huffman_encode_tests(strlen(data),data);

    char* message = malloc(strlen(str1) + strlen(result) + strlen(str2) + strlen(expected_result) + 1);
    strcpy(message, str1);
    strcat(message, result);
    strcat(message, str2);
    strcat(message, expected_result);
    
    mu_assert(message, !strcmp(result, expected_result));

    free(message);
    free(result);
    return 0;

}

static char *all_tests() {
    mu_run_test(testSimpleString);
    mu_run_test(testVeryLongString);
    return 0;
}



///we need tests for huffman_encode_file_input////


int main(void) {

    char *result = all_tests();
    if (result == 0) {
        printf("ALL TESTS PASSED\n");
    } else {
        printf("TESTS FAILED: %s\n", result);
    }
    printf("Tests run: %d\n", tests_run);

    return result != 0;
}
